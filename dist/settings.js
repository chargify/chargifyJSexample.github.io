(()=>{var s=crypto,w=t=>t instanceof CryptoKey;var u=new TextEncoder,m=new TextDecoder,lt=2**32;function S(...t){let e=t.reduce((o,{length:f})=>o+f,0),r=new Uint8Array(e),n=0;return t.forEach(o=>{r.set(o,n),n+=o.length}),r}var z=t=>{let e=t;typeof e=="string"&&(e=u.encode(e));let r=32768,n=[];for(let o=0;o<e.length;o+=r)n.push(String.fromCharCode.apply(null,e.subarray(o,o+r)));return btoa(n.join(""))},h=t=>z(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var _=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var r;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}};var a=class extends _{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}};var y=class extends _{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},A=class extends _{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}};var N=s.getRandomValues.bind(s);function v(){return typeof WebSocketPair<"u"||typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"||typeof EdgeRuntime<"u"&&EdgeRuntime==="vercel"}function g(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function J(t,e){return t.name===e}function X(t){return parseInt(t.name.slice(4),10)}function ge(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Se(t,e){if(e.length&&!e.some(r=>t.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(e.length>2){let n=e.pop();r+=`one of ${e.join(", ")}, or ${n}.`}else e.length===2?r+=`one of ${e[0]} or ${e[1]}.`:r+=`${e[0]}.`;throw new TypeError(r)}}function re(t,e,...r){switch(e){case"HS256":case"HS384":case"HS512":{if(!J(t.algorithm,"HMAC"))throw g("HMAC");let n=parseInt(e.slice(2),10);if(X(t.algorithm.hash)!==n)throw g(`SHA-${n}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!J(t.algorithm,"RSASSA-PKCS1-v1_5"))throw g("RSASSA-PKCS1-v1_5");let n=parseInt(e.slice(2),10);if(X(t.algorithm.hash)!==n)throw g(`SHA-${n}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!J(t.algorithm,"RSA-PSS"))throw g("RSA-PSS");let n=parseInt(e.slice(2),10);if(X(t.algorithm.hash)!==n)throw g(`SHA-${n}`,"algorithm.hash");break}case(v()&&"EdDSA"):{if(!J(t.algorithm,"NODE-ED25519"))throw g("NODE-ED25519");break}case"EdDSA":{if(t.algorithm.name!=="Ed25519"&&t.algorithm.name!=="Ed448")throw g("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!J(t.algorithm,"ECDSA"))throw g("ECDSA");let n=ge(e);if(t.algorithm.namedCurve!==n)throw g(n,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Se(t,r)}function ne(t,e,...r){if(r.length>2){let n=r.pop();t+=`one of type ${r.join(", ")}, or ${n}.`}else r.length===2?t+=`one of type ${r[0]} or ${r[1]}.`:t+=`of type ${r[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&e.constructor&&e.constructor.name&&(t+=` Received an instance of ${e.constructor.name}`),t}var E=(t,...e)=>ne("Key must be ",t,...e);function Y(t,e,...r){return ne(`Key for the ${t} algorithm must be `,e,...r)}var q=t=>w(t),i=["CryptoKey"];var xe=(...t)=>{let e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let r;for(let n of e){let o=Object.keys(n);if(!r||r.size===0){r=new Set(o);continue}for(let f of o){if(r.has(f))return!1;r.add(f)}}return!0},x=xe;function Ke(t){return typeof t=="object"&&t!==null}function l(t){if(!Ke(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}var $=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){let{modulusLength:r}=e.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}};var Je=(t,e)=>{if(!(e instanceof Uint8Array)){if(!q(e))throw new TypeError(Y(t,e,...i,"Uint8Array"));if(e.type!=="secret")throw new TypeError(`${i.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},Ie=(t,e,r)=>{if(!q(e))throw new TypeError(Y(t,e,...i));if(e.type==="secret")throw new TypeError(`${i.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(r==="sign"&&e.type==="public")throw new TypeError(`${i.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(r==="decrypt"&&e.type==="public")throw new TypeError(`${i.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&r==="verify"&&e.type==="private")throw new TypeError(`${i.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&r==="encrypt"&&e.type==="private")throw new TypeError(`${i.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},Te=(t,e,r)=>{t.startsWith("HS")||t==="dir"||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?Je(t,e):Ie(t,e,r)},T=Te;function Ne(t,e,r,n,o){if(o.crit!==void 0&&n.crit===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||n.crit===void 0)return new Set;if(!Array.isArray(n.crit)||n.crit.length===0||n.crit.some(p=>typeof p!="string"||p.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let f;r!==void 0?f=new Map([...Object.entries(r),...e.entries()]):f=e;for(let p of n.crit){if(!f.has(p))throw new a(`Extension Header Parameter "${p}" is not recognized`);if(o[p]===void 0)throw new t(`Extension Header Parameter "${p}" is missing`);if(f.get(p)&&n[p]===void 0)throw new t(`Extension Header Parameter "${p}" MUST be integrity protected`)}return new Set(n.crit)}var H=Ne;var Fe=Symbol();function B(t,e){let r=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:t.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:e.namedCurve};case(v()&&"EdDSA"):let{namedCurve:n}=e;return{name:n,namedCurve:n};case"EdDSA":return{name:e.name};default:throw new a(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}function L(t,e,r){if(w(e))return re(e,t,r),e;if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(E(e,...i));return s.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(E(e,...i,"Uint8Array"))}var D=t=>Math.floor(t.getTime()/1e3);var ze=/^(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)$/i,G=t=>{let e=ze.exec(t);if(!e)throw new TypeError("Invalid time period format");let r=parseFloat(e[1]);switch(e[2].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":return Math.round(r);case"minute":case"minutes":case"min":case"mins":case"m":return Math.round(r*60);case"hour":case"hours":case"hr":case"hrs":case"h":return Math.round(r*3600);case"day":case"days":case"d":return Math.round(r*86400);case"week":case"weeks":case"w":return Math.round(r*604800);default:return Math.round(r*31557600)}};var Ze=async(t,e,r)=>{let n=await L(t,e,"sign");$(t,n);let o=await s.subtle.sign(B(t,n.algorithm),n,r);return new Uint8Array(o)},pe=Ze;var C=class{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,r){if(!this._protectedHeader&&!this._unprotectedHeader)throw new y("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!x(this._protectedHeader,this._unprotectedHeader))throw new y("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...this._protectedHeader,...this._unprotectedHeader},o=H(y,new Map([["b64",!0]]),r?.crit,this._protectedHeader,n),f=!0;if(o.has("b64")&&(f=this._protectedHeader.b64,typeof f!="boolean"))throw new y('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:p}=n;if(typeof p!="string"||!p)throw new y('JWS "alg" (Algorithm) Header Parameter missing or invalid');T(p,e,"sign");let U=this._payload;f&&(U=u.encode(h(U)));let M;this._protectedHeader?M=u.encode(h(JSON.stringify(this._protectedHeader))):M=u.encode("");let he=S(M,u.encode("."),U),ye=await pe(p,e,he),k={signature:h(ye),payload:""};return f&&(k.payload=m.decode(U)),this._unprotectedHeader&&(k.header=this._unprotectedHeader),this._protectedHeader&&(k.protected=m.decode(M)),k}};var R=class{constructor(e){this._flattened=new C(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,r){let n=await this._flattened.sign(e,r);if(n.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${n.protected}.${n.payload}.${n.signature}`}};var P=class{constructor(e){if(!l(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:e}:this._payload={...this._payload,nbf:D(new Date)+G(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:e}:this._payload={...this._payload,exp:D(new Date)+G(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:D(new Date)}:this._payload={...this._payload,iat:e},this}};var O=class extends P{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,r){var n;let o=new R(u.encode(JSON.stringify(this._payload)));if(o.setProtectedHeader(this._protectedHeader),Array.isArray((n=this._protectedHeader)===null||n===void 0?void 0:n.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new A("JWTs MUST NOT use unencoded payload");return o.sign(e,r)}};var W=document.getElementById("chargify-js-src"),F=document.getElementById("public-key"),Q=document.getElementById("private-key"),j=document.getElementById("server-host"),V=document.getElementById("examples"),ue=document.getElementById("gateway-handle"),le=document.getElementById("one-time-token"),ee=document.getElementById("settings-submit"),fe=document.getElementById("settings-loading"),nt=document.getElementById("errors-box"),c=window.localStorage,d=c.getItem("context")||"1",ot=async(t,e)=>{if(!e||!t)return null;let r=new TextEncoder().encode(e);return new O({}).setProtectedHeader({alg:"HS256"}).setIssuer(t).setJti(self.crypto.randomUUID()).setSubject(self.crypto.randomUUID()).sign(r)};W.value=c.getItem(`${d}chargifyJsSrc`);F.value=c.getItem(`${d}publicKey`);Q.value=c.getItem(`${d}privateKey`);j.value=c.getItem(`${d}serverHost`);V.value=c.getItem(`${d}example`);ue.value=c.getItem(`${d}gatewayHandle`);le.value=c.getItem(`${d}oneTimeToken`);W.value||(W.value="https://js.chargify.com/latest/chargify.js");(!W.value||!F.value||!j.value||!V.value)&&(nt.style.display="block");var at=()=>{ee.style.display="none",fe.style.display="block",c.setItem("context",d),c.setItem(`${d}chargifyJsSrc`,W.value),c.setItem(`${d}publicKey`,F.value),c.setItem(`${d}privateKey`,Q.value),c.setItem(`${d}serverHost`,j.value),c.setItem(`${d}example`,V.value),c.setItem(`${d}gatewayHandle`,ue.value),c.setItem(`${d}oneTimeToken`,le.value),ot(F.value,Q.value).then(t=>c.setItem(`${d}securityToken`,t)).then(()=>location.reload())};ee.addEventListener("click",at);var it=t=>{c.setItem("context",t),location.reload()},st=document.querySelectorAll(".context-button");st.forEach(t=>{t.addEventListener("click",()=>{it(t.value)}),t.value===d&&t.classList.add("active")});var me=document.createElement("script");me.setAttribute("src",W.value);document.head.appendChild(me);setTimeout(()=>{let t=document.createElement("script");t.setAttribute("src",`./example/${V.value}.js`),document.head.appendChild(t);let e=document.createElement("script");e.setAttribute("src","./example/submit.js"),document.head.appendChild(e),fe.style.display="none",ee.style.display="block"},2e3);})();
//# sourceMappingURL=settings.js.map
